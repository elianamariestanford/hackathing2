{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///Users/elianastanford/hackathing2/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth, { type NextAuthOptions } from \"next-auth\";\nimport GoogleProvider from \"next-auth/providers/google\";\n\nexport const authOptions: NextAuthOptions = {\n  providers: [\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID!,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n      authorization: {\n        params: {\n          scope:\n            \"openid email profile https://www.googleapis.com/auth/calendar.readonly\",\n          access_type: \"offline\",\n          prompt: \"consent\",\n        },\n      },\n    }),\n  ],\n  callbacks: {\n    async jwt({ token, account }) {\n      if (account?.access_token) (token as any).accessToken = account.access_token;\n      return token;\n    },\n    async session({ session, token }) {\n      (session as any).accessToken = (token as any).accessToken;\n      return session;\n    },\n  },\n};\n\nconst handler = NextAuth(authOptions);\nexport { handler as GET, handler as POST };\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEO,MAAM,cAA+B;IAC1C,WAAW;QACT,IAAA,gKAAc,EAAC;YACb,UAAU,QAAQ,GAAG,CAAC,gBAAgB;YACtC,cAAc,QAAQ,GAAG,CAAC,oBAAoB;YAC9C,eAAe;gBACb,QAAQ;oBACN,OACE;oBACF,aAAa;oBACb,QAAQ;gBACV;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,OAAO,EAAE;YAC1B,IAAI,SAAS,cAAc,AAAC,MAAc,WAAW,GAAG,QAAQ,YAAY;YAC5E,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC7B,QAAgB,WAAW,GAAG,AAAC,MAAc,WAAW;YACzD,OAAO;QACT;IACF;AACF;AAEA,MAAM,UAAU,IAAA,kJAAQ,EAAC"}},
    {"offset": {"line": 191, "column": 0}, "map": {"version":3,"sources":["file:///Users/elianastanford/hackathing2/lib/categorize.ts"],"sourcesContent":["const ACADEMIC_KWS = [\n    \"class\",\n    \"lecture\",\n    \"lab\",\n    \"office hours\",\n    \"oh\",\n    \"discussion\",\n    \"study\",\n    \"seminar\",\n    \"section\",\n    \"review\",\n    \"midterm\",\n    \"final\",\n    \"exam\",\n  ];\n  \n  const SOCIAL_KWS = [\n    \"party\",\n    \"dinner\",\n    \"drinks\",\n    \"hang\",\n    \"date\",\n    \"birthday\",\n    \"brunch\",\n    \"concert\",\n    \"game night\",\n  ];\n  \n  export type Category = \"Academic\" | \"Social\" | \"Other\";\n  \n  export function categorize(title: string): Category {\n    const t = (title || \"\").toLowerCase();\n    if (ACADEMIC_KWS.some((k) => t.includes(k))) return \"Academic\";\n    if (SOCIAL_KWS.some((k) => t.includes(k))) return \"Social\";\n    return \"Other\";\n  }\n  "],"names":[],"mappings":";;;;AAAA,MAAM,eAAe;IACjB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAED,MAAM,aAAa;IACjB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAIM,SAAS,WAAW,KAAa;IACtC,MAAM,IAAI,CAAC,SAAS,EAAE,EAAE,WAAW;IACnC,IAAI,aAAa,IAAI,CAAC,CAAC,IAAM,EAAE,QAAQ,CAAC,KAAK,OAAO;IACpD,IAAI,WAAW,IAAI,CAAC,CAAC,IAAM,EAAE,QAAQ,CAAC,KAAK,OAAO;IAClD,OAAO;AACT"}},
    {"offset": {"line": 231, "column": 0}, "map": {"version":3,"sources":["file:///Users/elianastanford/hackathing2/lib/aggregate.ts"],"sourcesContent":["import { startOfWeek } from \"date-fns\";\nimport { categorize, Category } from \"./categorize\";\n\nexport type EventRow = {\n  summary: string;\n  startISO: string;\n  endISO: string;\n  hours: number;\n  category: Category;\n  weekStartISO: string;\n};\n\nexport type WeeklyTotals = {\n  weekStartISO: string;\n  Academic: number;\n  Social: number;\n  Other: number;\n};\n\nexport function toHours(startISO: string, endISO: string) {\n  const start = new Date(startISO).getTime();\n  const end = new Date(endISO).getTime();\n  return Math.max(0, (end - start) / (1000 * 60 * 60));\n}\n\nexport function normalizeGoogleEvent(ev: any): { startISO: string; endISO: string } | null {\n  const start = ev?.start?.dateTime ?? ev?.start?.date;\n  const end = ev?.end?.dateTime ?? ev?.end?.date;\n  if (!start || !end) return null;\n\n  // All-day events come as YYYY-MM-DD; treat as midnight UTC-ish in JS Date parsing.\n  const startISO = start.includes(\"T\") ? start : `${start}T00:00:00`;\n  const endISO = end.includes(\"T\") ? end : `${end}T00:00:00`;\n  return { startISO, endISO };\n}\n\nexport function aggregateWeekly(events: any[]): { rows: EventRow[]; weekly: WeeklyTotals[] } {\n  const rows: EventRow[] = [];\n\n  for (const ev of events) {\n    const summary = ev?.summary ?? \"(no title)\";\n    const norm = normalizeGoogleEvent(ev);\n    if (!norm) continue;\n\n    const hours = toHours(norm.startISO, norm.endISO);\n    if (hours <= 0) continue;\n\n    const category = categorize(summary);\n\n    const weekStart = startOfWeek(new Date(norm.startISO), { weekStartsOn: 1 }); // Monday\n    const weekStartISO = weekStart.toISOString().slice(0, 10);\n\n    rows.push({\n      summary,\n      startISO: norm.startISO,\n      endISO: norm.endISO,\n      hours,\n      category,\n      weekStartISO,\n    });\n  }\n\n  const map = new Map<string, WeeklyTotals>();\n\n  for (const r of rows) {\n    if (!map.has(r.weekStartISO)) {\n      map.set(r.weekStartISO, {\n        weekStartISO: r.weekStartISO,\n        Academic: 0,\n        Social: 0,\n        Other: 0,\n      });\n    }\n    const wk = map.get(r.weekStartISO)!;\n    wk[r.category] += r.hours;\n  }\n\n  const weekly = Array.from(map.values()).sort((a, b) =>\n    a.weekStartISO.localeCompare(b.weekStartISO)\n  );\n\n  // Ensure 4 weeks appear even if zero events (optional; simple version skips)\n  return { rows, weekly };\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAkBO,SAAS,QAAQ,QAAgB,EAAE,MAAc;IACtD,MAAM,QAAQ,IAAI,KAAK,UAAU,OAAO;IACxC,MAAM,MAAM,IAAI,KAAK,QAAQ,OAAO;IACpC,OAAO,KAAK,GAAG,CAAC,GAAG,CAAC,MAAM,KAAK,IAAI,CAAC,OAAO,KAAK,EAAE;AACpD;AAEO,SAAS,qBAAqB,EAAO;IAC1C,MAAM,QAAQ,IAAI,OAAO,YAAY,IAAI,OAAO;IAChD,MAAM,MAAM,IAAI,KAAK,YAAY,IAAI,KAAK;IAC1C,IAAI,CAAC,SAAS,CAAC,KAAK,OAAO;IAE3B,mFAAmF;IACnF,MAAM,WAAW,MAAM,QAAQ,CAAC,OAAO,QAAQ,GAAG,MAAM,SAAS,CAAC;IAClE,MAAM,SAAS,IAAI,QAAQ,CAAC,OAAO,MAAM,GAAG,IAAI,SAAS,CAAC;IAC1D,OAAO;QAAE;QAAU;IAAO;AAC5B;AAEO,SAAS,gBAAgB,MAAa;IAC3C,MAAM,OAAmB,EAAE;IAE3B,KAAK,MAAM,MAAM,OAAQ;QACvB,MAAM,UAAU,IAAI,WAAW;QAC/B,MAAM,OAAO,qBAAqB;QAClC,IAAI,CAAC,MAAM;QAEX,MAAM,QAAQ,QAAQ,KAAK,QAAQ,EAAE,KAAK,MAAM;QAChD,IAAI,SAAS,GAAG;QAEhB,MAAM,WAAW,IAAA,iIAAU,EAAC;QAE5B,MAAM,YAAY,IAAA,2JAAW,EAAC,IAAI,KAAK,KAAK,QAAQ,GAAG;YAAE,cAAc;QAAE,IAAI,SAAS;QACtF,MAAM,eAAe,UAAU,WAAW,GAAG,KAAK,CAAC,GAAG;QAEtD,KAAK,IAAI,CAAC;YACR;YACA,UAAU,KAAK,QAAQ;YACvB,QAAQ,KAAK,MAAM;YACnB;YACA;YACA;QACF;IACF;IAEA,MAAM,MAAM,IAAI;IAEhB,KAAK,MAAM,KAAK,KAAM;QACpB,IAAI,CAAC,IAAI,GAAG,CAAC,EAAE,YAAY,GAAG;YAC5B,IAAI,GAAG,CAAC,EAAE,YAAY,EAAE;gBACtB,cAAc,EAAE,YAAY;gBAC5B,UAAU;gBACV,QAAQ;gBACR,OAAO;YACT;QACF;QACA,MAAM,KAAK,IAAI,GAAG,CAAC,EAAE,YAAY;QACjC,EAAE,CAAC,EAAE,QAAQ,CAAC,IAAI,EAAE,KAAK;IAC3B;IAEA,MAAM,SAAS,MAAM,IAAI,CAAC,IAAI,MAAM,IAAI,IAAI,CAAC,CAAC,GAAG,IAC/C,EAAE,YAAY,CAAC,aAAa,CAAC,EAAE,YAAY;IAG7C,6EAA6E;IAC7E,OAAO;QAAE;QAAM;IAAO;AACxB"}},
    {"offset": {"line": 306, "column": 0}, "map": {"version":3,"sources":["file:///Users/elianastanford/hackathing2/app/api/events/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { getServerSession } from \"next-auth\";\nimport { authOptions } from \"../auth/[...nextauth]/route\";\nimport { google } from \"googleapis\";\nimport { addWeeks } from \"date-fns\";\nimport { aggregateWeekly } from \"../../../lib/aggregate\";\n\nexport const runtime = \"nodejs\";\n\nexport async function GET() {\n  const session = await getServerSession(authOptions);\n  const accessToken = (session as any)?.accessToken as string | undefined;\n\n  if (!accessToken) {\n    // helpful debug\n    console.error(\"No accessToken on session:\", session);\n    return NextResponse.json({ error: \"Not authenticated\" }, { status: 401 });\n  }\n\n  try {\n    const auth = new google.auth.OAuth2();\n    auth.setCredentials({ access_token: accessToken });\n\n    const calendar = google.calendar({ version: \"v3\", auth });\n\n    const timeMin = new Date().toISOString();\n    const timeMax = addWeeks(new Date(), 4).toISOString();\n\n    const resp = await calendar.events.list({\n      calendarId: \"primary\",\n      timeMin,\n      timeMax,\n      singleEvents: true,\n      orderBy: \"startTime\",\n      maxResults: 2500,\n    });\n\n    const items = resp.data.items ?? [];\n    const { weekly } = aggregateWeekly(items);\n\n    return NextResponse.json({ weekly });\n  } catch (err: any) {\n    // This will usually contain the real Google error (401/403 + message)\n    console.error(\"Google Calendar API error:\", err?.response?.data || err);\n\n    return NextResponse.json(\n      {\n        error: \"Google Calendar fetch failed\",\n        details: err?.response?.data || String(err),\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEO,MAAM,UAAU;AAEhB,eAAe;IACpB,MAAM,UAAU,MAAM,IAAA,2JAAgB,EAAC,kKAAW;IAClD,MAAM,cAAe,SAAiB;IAEtC,IAAI,CAAC,aAAa;QAChB,gBAAgB;QAChB,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;IACzE;IAEA,IAAI;QACF,MAAM,OAAO,IAAI,+JAAM,CAAC,IAAI,CAAC,MAAM;QACnC,KAAK,cAAc,CAAC;YAAE,cAAc;QAAY;QAEhD,MAAM,WAAW,+JAAM,CAAC,QAAQ,CAAC;YAAE,SAAS;YAAM;QAAK;QAEvD,MAAM,UAAU,IAAI,OAAO,WAAW;QACtC,MAAM,UAAU,IAAA,qJAAQ,EAAC,IAAI,QAAQ,GAAG,WAAW;QAEnD,MAAM,OAAO,MAAM,SAAS,MAAM,CAAC,IAAI,CAAC;YACtC,YAAY;YACZ;YACA;YACA,cAAc;YACd,SAAS;YACT,YAAY;QACd;QAEA,MAAM,QAAQ,KAAK,IAAI,CAAC,KAAK,IAAI,EAAE;QACnC,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,qIAAe,EAAC;QAEnC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAO;IACpC,EAAE,OAAO,KAAU;QACjB,sEAAsE;QACtE,QAAQ,KAAK,CAAC,8BAA8B,KAAK,UAAU,QAAQ;QAEnE,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,KAAK,UAAU,QAAQ,OAAO;QACzC,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}